/**
 * Comments Stylesheet
 *
 * A lot of the comments markup is generated automatically by WordPress, making
 * it awkward to namespace. There is some heavy nesting here to migigate this.
 *
 * @package     danfoy_2019
 * @subpackage  comments
 * @author      Dan Foy <danfoy.com>
 * @since       1.0.0
 */

/**
 * Gutters
 */
.responses-title,
.responses-comments-title,
.responses-pings-title,
.comment-body,
.respond .comment-meta {
    margin-left: gutter(1);
    margin-right: gutter(1);
}

/**
 * Sectioning
 */
.responses { // <aside>
    margin-top: 3em;            // Breathing space from .post-meta
    font-family: $sans-serif;
}

// Titles
.responses-title,
.responses-comments-title,
.responses-pings-title,
.respond-form-title {
    padding-top: 1em;
    padding-bottom: 1em;
    margin-top: 0;
    margin-bottom: 0;
    text-transform: uppercase;
    font-weight: 700;
    text-align: center;

    // Hide .responses-title generally, it's just for accessibility
    @at-root .responses-title {
        @include hide-visually;
    }
}


/**
 * Pingbacks
 *
 * Pingbacks are separated from comments.
 *
 */
.responses-pings-list { // <ol>
    text-transform: uppercase;      // Differentiate from link
    font-size: 0.65em;              // Differentiate from link
    margin-top: 1em;                // Whitespace
    margin-bottom: 1em;             // Whitespace

    .pingback { // <li>
        position: relative;
        padding-top: 1em;
        padding-bottom: 1em;
    }

    a {
        text-decoration: none;      // Remove underline
        text-transform: initial;    // Override uppercase transform above
    }

    .url { // <a>
        font-size: $em_base;        // Override font size above
        font-style: italic;         // Differentiate from other links
        display: block;             // Newline separate from label
        line-height: 1;             // Tighter spacing on wrapping links
    }

    .edit-link { // <span>
        position: absolute;
        bottom: 0;
        right: 0;
    }
}

// Serif fonts for content
.comment-content,
.respond-form-input-comment { // <div>
    font-family: $serif;
    line-height: 1.4;       // Match paragraph style
}

.responses-comments-list,   // <ol>
.responses-pings-list {     // <ol>
    padding-left: 0;        // Override native list padding
    margin-top: 0;          // Override native list margin
    margin-bottom: 0;       // Override native list margin
    list-style-type: none;  // Override native list style

    > .comment:last-of-type {
        border-bottom: 1px solid;
    }
}

.comment { // <li>
    padding-top: 1em;           // Breathing room for header
    border-top: 1px solid;      // To separate comments
    list-style-type: none;      // Override useragent styles
    overflow: hidden;           // Prevent commenters breaking the scaffolding

    p:last-of-type {
        margin-bottom: 0.5em;   // Tighten up to reply link
    }

    .comment-body { // <article>
        padding-bottom: 0.5em; // Line up with global padding
    }

    // Nested comments
    .children {
        padding-left: 0;

        .comment {
            padding-top: 0.5em;
            margin-left: gutter(1);     // 1 indent per level
            border-top: none;
            border-left: 1px solid;

            // Smaller child avatars
            .avatar {
                width: 4.2rem !important;   // Set inline by WP
                height: 4.2rem !important;  // Set inline by WP
            }
            // Match padding to new shrunken avatar
            .comment-meta {
                min-height: 4.2rem;
                padding-left: 5.2rem;

                // Smaller author title when nested
                .fn { // <b> author name
                    font-size: 0.8em;
                }
            }

            // Give replies breathing room when nested
            .reply {
                padding-top: 1em;
                padding-bottom: gutter(1);
            }
        }
    }

    // Trim top-level comments with children
    &.depth-1.parent {
        padding-bottom: 1em;
    }

    // Remove padding on last paragraph of threadded comments
    // Bumps up the reply link
    &.parent p:last-of-type {
        margin-bottom: 0;
    }
}

/**
 * Comment meta section generated mostly by WordPress, sometimes with awkward
 * names. Nesting them all here to keep the .respond-meta section self-contained
 */
.comment-meta {
    position: relative;         // So .avatar can be positioned absolutely
    min-height: 6.4rem;         // At least as high as avatar
    padding-left: 7.4rem;       // Allow space +10px margin for avatar
    display: flex;
    flex-direction: column;     // Stack items vertically
    justify-content: center;

    // Add back margins usually provided by .comment
    @at-root #respond .comment-meta {
        margin: 0.5em gutter(1) 0.5em gutter(1);
    }

    .comment-author {

        .avatar { // <img>
            position: absolute; // Necessary due to how WP structures this
            top: 0;
            left: 0;
            border-radius: 32px;// Circularize the gravatar
        }

        .fn { // <b> Comment author name. Seriously who named this.
            display: block;
        }

        .says { // <span>
            display: none;      // Remove 'says' text added by WordPress
        }
    }

    @at-root .comment-metadata {
        font-size: 0.7em;   // Metadata should be smaller than content

        .edit-link {
            padding-left: 0.5em;    // Space out the edit link from the date

            &:before {
                content: "/";           // Separator from meta
                padding-right: 0.5em;   // Center
            }
        }
    }
}

.comment-meta a,
.reply a,
#respond a {
    text-decoration: none;
}

.reply {
    text-align: right;          // Reply link looks more balanced opposite gravatar
    font-size: 0.8em;           // Smaller text

    small:after {
        content: "\2193";       // A down arrow
        padding-left: 0.5em;   // Mimic a space
        font-weight: 700;
    }
}



#respond {
    padding-top: 0.5em;
    padding-bottom: 0.5em;

    // Override: Trim respond to fit while nested
    @at-root .content #respond {
        padding-top: 0;
        padding-bottom: 1em;
    }

    // Cancel reply link generated by WordPress and controlled by a core script
    #cancel-comment-reply-link {
        margin-bottom: 1em;             // Add space between commenter meta area
        margin-right: gutter(1);        // Line up with reply links
        float: right;                   // Line up with reply links
        font-size: calc(#{$em_base} * 0.7); // Match reply links

        &:after {
            content: "x";               // Close button
            padding-left: 0.5em;        // <space>
        }
    }

    // Labels should appear on form items when placeholder text is not supported
    .respond-form-label {
        display: block;
        margin-top: 1em;
        font-size: 0.8em;
        text-transform: uppercase;

        // Hide labels when placeholder text available
        @at-root .placeholder .respond-form-label {
            @include hide-visually;
        }
    }

    // form elements have half the margin of all other elements, but the
    // same again as padding. This makes their content line up with the
    // site content.
    .respond-form-element {
        display: block;
        box-sizing: border-box;
        width: calc(100% - #{gutter(1)} );
        margin: gutter(0.5);
        padding: gutter(0.5);
        border: 1px solid black;
        font-family: $sans-serif;

        &:first-of-type {
            margin-top: 0;          // Handled by container
        }
    }

    .respond-form-input-comment {
        height: 7.5em;

        // Remove all borders except bottom on comment textarea.
        // This makes it match the style of published posts.
        // But only when placeholder text is available and posts exist.
        @at-root .placeholder .has-comments .respond-form-input-comment {
            border-top: none;
            border-left: none;
            border-right: none;
        }
    }

    .form-submit {              // <p>, annoyingly added by comment_form();
        margin-top: 0;          // Reset, added by browser
        margin-bottom: 0;       // Reset, added by browser

        .submit {               // <input type="submit">
            cursor: pointer;    // Act like a button
            margin-bottom: 0;   // Don't collapse surrounding margin
        }
    }

}

.respond-closed {
    text-align: center;
    margin: 2em gutter(1);
}
